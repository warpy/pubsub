(function(a){"use strict";function b(b){var c={};return a.isString(b)?a.each(b.split(/[\s*\,\s*]+/g),function(a,b){c[b]=0===a.indexOf("!")?[a.substr(1),!0]:[a,!0]}):a.isArray(b)?a.each(b,function(a,b){c[b]=0===a.indexOf("!")?[a.substr(1),!0]:[a,!0]}):a.each(b,function(a,b){c[b]=[a,!1,!1]}),c}function c(b,c){this.id="token_"+h++,this.topic=b,this.callback=c,this.conditions=[],a.each(b.split("|"),function(a){this.conditions.push(new d(a,this.id))},this)}function d(b,c){this.checks=[],this.token=c,this.hasString=!1,a.each(b.split("&"),function(a){var b=a.split("="),c=!1,d=!1;1===b.length&&(d=!0,this.hasString=!0,b.unshift("sanket"));var e=b[0];b[0].indexOf("!")===b[0].length-1&&(c=!0,e=b[0].substr(0,b[0].length-1));var f=b[1];0===b[1].indexOf("!")&&(c=!0,f=b[1].substr(1)),this.checks.push({isNegative:c,isString:d,key:e,value:f})},this)}function e(b,d){var e=new c(b,d);return this.tokens[e.id]=e,this.conditions=a.union(this.conditions,e.conditions),e.id}function f(c,d){var e={};return c=b(c),a.each(this.conditions,function(a){a.qualifies(c)&&(e[a.token]=!0)},this),a.each(e,function(a,b){this.tokens[b].callback.call(null,d)},this),a.keys(e)}var g=function(){this.tokens={},this.conditions=[]},h=1;d.prototype.qualifies=function(b){var c,d=a.keys(b),e=a.pluck(b,0),f=a.unique(a.pluck(this.checks,"key")),g=f.length===a.intersection(f,d).length,h=!1;return a.each(b,function(a){a[1]&&this.hasString&&(h=!0)},this),c=g||h,c&&a.each(this.checks,function(d){var f=!1;h&&d.isString&&(f=d.isNegative?-1===a.indexOf(e,d.value):a.indexOf(e,d.value)>-1),g&&(f=d.isNegative?d.value!=b[d.key][0]:d.value==b[d.key][0]),c=c&&f},this),c},g.prototype.bind=function(a,b){return e.call(this,a,b)},g.prototype.trigger=function(a,b){return f.call(this,a,b)},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports?exports=module.exports=g:this.PubSub=g}).call(this,_);